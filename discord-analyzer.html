<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>discord-analyzer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="discord-analyzer_files/libs/clipboard/clipboard.min.js"></script>
<script src="discord-analyzer_files/libs/quarto-html/quarto.js"></script>
<script src="discord-analyzer_files/libs/quarto-html/popper.min.js"></script>
<script src="discord-analyzer_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="discord-analyzer_files/libs/quarto-html/anchor.min.js"></script>
<link href="discord-analyzer_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="discord-analyzer_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="discord-analyzer_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="discord-analyzer_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="discord-analyzer_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="discord-analyzer" class="level1">
<h1>Discord analyzer</h1>
<p>The point of this project is to extract Discord messages, analyze them and see what I can find out.</p>
<p>So I’ll start with some includes…</p>
<div class="cell" data-execution_count="165">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"darkgrid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data preparation</h3>
<p>Next, time to load the extracted data, drop the columns I won’t be using and prepare the dataframe for further analysis. Lastly, I’ll print out the columns to get a better idea of what is in the dataframe without exposing any of the messages.</p>
<div class="cell" data-execution_count="166">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'chat.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'AuthorID'</span>, <span class="st">'Reactions'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Author'</span>] <span class="op">=</span> df[<span class="st">'Author'</span>].<span class="bu">str</span>.replace(<span class="vs">r"#[0-9]+"</span>, <span class="st">""</span>)  <span class="co"># leave only usernames</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Content'</span>] <span class="op">=</span> df[<span class="st">'Content'</span>].fillna(<span class="st">""</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>df.insert(<span class="dv">2</span>, <span class="st">'Time'</span>, pd.to_datetime(df[<span class="st">'Date'</span>]).dt.time)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>]).dt.date</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="166">
<pre><code>Index(['Author', 'Date', 'Time', 'Content', 'Attachments'], dtype='object')</code></pre>
</div>
</div>
</section>
<section id="basic-information-about-messages-in-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="basic-information-about-messages-in-the-dataset">Basic information about messages in the dataset</h3>
<p>Next two cells will give us the most basic information we can get: total messages per author, mean, median, etc… you get the idea.</p>
<p>Additionally, I’ll try to find the so-called highest streak: the maximum period of days when at least one message was sent per day.</p>
<div class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_the_highest_streak(msgs_per_day: pd.Series) <span class="op">-&gt;</span> <span class="bu">tuple</span>:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Finds and returns the highest messaging streak found in the dataset.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Think of it as snapchat fires. But on discord.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :param msgs_per_day: series where index represents every day when message has been sent</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: start of the streak, end of the streak, duration of the streak</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    days <span class="op">=</span> msgs_per_day.sort_index().index</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    start, end, prev, streak <span class="op">=</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    max_start, max_end, max_streak <span class="op">=</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    one_day <span class="op">=</span> pd.DateOffset()</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> day <span class="kw">in</span> days:</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> start <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            start, prev <span class="op">=</span> day, day</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> prev <span class="op">+</span> one_day <span class="op">==</span> day:</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            prev <span class="op">=</span> day</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            streak <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            streak <span class="op">=</span> streak <span class="op">+</span> <span class="dv">1</span> <span class="cf">if</span> streak <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            end <span class="op">=</span> prev <span class="cf">if</span> streak <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> streak <span class="op">&gt;</span> max_streak:</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                max_start, max_end, max_streak <span class="op">=</span> start, end, streak</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            start, prev, end, streak <span class="op">=</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> streak <span class="op">&gt;</span> max_streak:</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> start, <span class="dv">0</span>, streak</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_start, max_end, max_streak</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>total_msgs <span class="op">=</span> <span class="bu">len</span>(df)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>messages <span class="op">=</span> df[<span class="st">'Author'</span>].value_counts()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>author_1, author_2 <span class="op">=</span> messages.index.to_numpy()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>msgs_per_author <span class="op">=</span> messages.values</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>date_val_cnts <span class="op">=</span> df[<span class="st">'Date'</span>].value_counts()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>max_msg_day, max_msg_cnt <span class="op">=</span> date_val_cnts.index[<span class="dv">0</span>], date_val_cnts[<span class="dv">0</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>msgs_info <span class="op">=</span> date_val_cnts.describe()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>start, end, streak <span class="op">=</span> get_the_highest_streak(date_val_cnts)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> [<span class="st">'Total message count'</span>, <span class="ss">f"</span><span class="sc">{</span>author_1<span class="sc">}</span><span class="ss">'s total message count"</span>, <span class="ss">f"</span><span class="sc">{</span>author_2<span class="sc">}</span><span class="ss">'s total message count"</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Number of days in dataset'</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Most messages per day date'</span>, <span class="st">'Most messages per day count'</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Messages per day mean'</span>, <span class="st">'Messages per day median'</span>, <span class="st">'Messages per day std'</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Highest message streak (days)'</span>, <span class="st">'Begin of the highest streak'</span>, <span class="st">'End of the highest streak'</span>]</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [total_msgs, msgs_per_author[<span class="dv">0</span>], msgs_per_author[<span class="dv">1</span>], <span class="bu">int</span>(msgs_info[<span class="dv">0</span>]),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        max_msg_day, max_msg_cnt,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        msgs_info[<span class="dv">1</span>], msgs_info[<span class="dv">5</span>], msgs_info[<span class="dv">2</span>],</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        streak, start, <span class="st">"ongoing"</span> <span class="cf">if</span> end <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> streak <span class="op">!=</span> <span class="dv">0</span> <span class="cf">else</span> end]</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>basic_info_df <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>index, data<span class="op">=</span>data, columns<span class="op">=</span>[<span class="st">'Data'</span>])</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(basic_info_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                     Data
Total message count                959905
A's total message count            486046
S's total message count            473859
Number of days in dataset            1668
Most messages per day date     2018-01-12
Most messages per day count          2996
Messages per day mean          575.482614
Messages per day median             394.0
Messages per day std           479.946682
Highest message streak (days)        1630
Begin of the highest streak    2017-07-18
End of the highest streak         ongoing</code></pre>
</div>
</div>
</section>
<section id="message-count-analysis" class="level3">
<h3 class="anchored" data-anchor-id="message-count-analysis">Message count analysis</h3>
<p>Next plot will show the amount of messages sent per day during the entire dataset timeline. Since the dataset is quite big, I’ll also plot the regression line to get the better idea of the data.</p>
<div class="cell" data-execution_count="169">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_messages_per_day(_df: pd.DataFrame, missing_days <span class="op">=</span> <span class="va">True</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates and returns a new dataframe with information how many messages were sent every day since beginning of messages in original dataframe until the last day in the dataset. It includes the days when no conversation took place.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    :param missing_days: boolean representing if missing days should be included in the dataset</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param _df: "raw" dataframe containing all messages</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: dataframe consisting of two columns: Day and Message count for that day</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    val_cnts <span class="op">=</span> _df[<span class="st">'Date'</span>].value_counts()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    ret <span class="op">=</span> pd.DataFrame(val_cnts).reset_index()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    ret.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'Day'</span>, <span class="st">'Date'</span>: <span class="st">'Message count'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> missing_days:</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        missing_days <span class="op">=</span> pd.date_range(start<span class="op">=</span>ret[<span class="st">'Day'</span>].<span class="bu">min</span>(), end<span class="op">=</span>ret[<span class="st">'Day'</span>].<span class="bu">max</span>())<span class="op">\</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            .difference(ret[<span class="st">'Day'</span>]).values</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        ret <span class="op">=</span> pd.concat(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            [ret,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>             pd.DataFrame(data<span class="op">=</span>[[pd.to_datetime(day).date(), <span class="dv">0</span>] <span class="cf">for</span> day <span class="kw">in</span> missing_days], columns<span class="op">=</span>[<span class="st">'Day'</span>, <span class="st">'Message count'</span>])],</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    ret.sort_values(by<span class="op">=</span><span class="st">'Day'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="170">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>msgs_per_day <span class="op">=</span> get_messages_per_day(df)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">7</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sns.lineplot(<span class="st">'Day'</span>, <span class="st">'Message count'</span>, data<span class="op">=</span>msgs_per_day).set_title(<span class="st">'Message count per day'</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the regression line</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>days <span class="op">=</span> np.array([i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(msgs_per_day))])</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>knr <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span><span class="bu">int</span>(<span class="fl">0.05</span> <span class="op">*</span> <span class="bu">len</span>(msgs_per_day)), n_jobs<span class="op">=-</span><span class="dv">1</span>, weights<span class="op">=</span><span class="st">'uniform'</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>knr.fit(X<span class="op">=</span>days.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), y<span class="op">=</span>msgs_per_day[<span class="st">'Message count'</span>])</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>predited <span class="op">=</span> knr.predict(days.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>sns.lineplot(msgs_per_day[<span class="st">'Day'</span>], predited, color<span class="op">=</span><span class="st">'yellow'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="170">
<pre><code>&lt;AxesSubplot:title={'center':'Message count per day'}, xlabel='Day', ylabel='Message count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-7-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="overall-distribution-of-messages-per-day" class="level2">
<h2 class="anchored" data-anchor-id="overall-distribution-of-messages-per-day">Overall distribution of messages per day</h2>
<p>If we treat messages per day as a random variable, what kind of distribution would it have?</p>
<div class="cell" data-execution_count="171">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">7</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>get_messages_per_day(df, missing_days<span class="op">=</span><span class="va">False</span>), x<span class="op">=</span><span class="st">'Message count'</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of messages per day"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="171">
<pre><code>Text(0.5, 1.0, 'Distribution of messages per day')</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1080x504 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-8-output-3.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="overall-distribution-of-messages-per-day-for-individual-author" class="level2">
<h2 class="anchored" data-anchor-id="overall-distribution-of-messages-per-day-for-individual-author">Overall distribution of messages per day for individual author</h2>
<p>After we took a look at the overall distribution, now we’ll take a look at the distributions for every author. The question is: are those two distributions the same?</p>
<div class="cell" data-execution_count="172">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>msgs_per_day_a1 <span class="op">=</span> get_messages_per_day(df[df[<span class="st">'Author'</span>] <span class="op">==</span> author_1], missing_days<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>msgs_per_day_a2 <span class="op">=</span> get_messages_per_day(df[df[<span class="st">'Author'</span>] <span class="op">==</span> author_2], missing_days<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>msgs_per_day_a1, x<span class="op">=</span><span class="st">'Message count'</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Distribution of messages per day for </span><span class="sc">{</span>author_1<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>sns.displot(data<span class="op">=</span>msgs_per_day_a2, x<span class="op">=</span><span class="st">'Message count'</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Distribution of messages per day for </span><span class="sc">{</span>author_2<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="172">
<pre><code>Text(0.5, 1.0, 'Distribution of messages per day for S')</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1080x504 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-9-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1080x504 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-9-output-5.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="173">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a combined dataset </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>msgs_per_day_a1[<span class="st">'Author'</span>] <span class="op">=</span> author_1</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>msgs_per_day_a2[<span class="st">'Author'</span>] <span class="op">=</span> author_2</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>combined_author_msgs <span class="op">=</span> pd.concat([msgs_per_day_a1, msgs_per_day_a2], ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="kernel-density-visualization-of-the-distributions" class="level2">
<h2 class="anchored" data-anchor-id="kernel-density-visualization-of-the-distributions">Kernel density visualization of the distributions</h2>
<p>So far, things are looking quite the same. I’ll plot both density distributions for better comparison.</p>
<div class="cell" data-execution_count="174">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>combined_author_msgs, x<span class="op">=</span><span class="st">'Message count'</span>, hue<span class="op">=</span><span class="st">'Author'</span>, cut<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of the messages per author"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="174">
<pre><code>Text(0.5, 1.0, 'Distribution of the messages per author')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-11-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>So far looking fairly similar.</p>
<p>I can also conclude that distributions deviate significantly from normal distribution, and it’s positively skewed.</p>
<p><i> A couple more distribution visualizations because why not… </i></p>
</section>
<section id="boxplot-visualization-of-the-distributions" class="level2">
<h2 class="anchored" data-anchor-id="boxplot-visualization-of-the-distributions">Boxplot visualization of the distributions</h2>
<div class="cell" data-execution_count="175">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>combined_author_msgs, x<span class="op">=</span><span class="st">'Author'</span>, y<span class="op">=</span><span class="st">'Message count'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of messages per author"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="175">
<pre><code>Text(0.5, 1.0, 'Distribution of messages per author')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="cumulative-distribution-for-each-author" class="level2">
<h2 class="anchored" data-anchor-id="cumulative-distribution-for-each-author">Cumulative distribution for each author</h2>
<div class="cell" data-execution_count="176">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>combined_author_msgs, x<span class="op">=</span><span class="st">'Message count'</span>, hue<span class="op">=</span><span class="st">'Author'</span>, stat<span class="op">=</span><span class="st">'density'</span>, bins<span class="op">=</span><span class="bu">len</span>(combined_author_msgs), element<span class="op">=</span><span class="st">'step'</span>, fill<span class="op">=</span><span class="va">False</span>, cumulative<span class="op">=</span><span class="va">True</span>, common_norm<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cumulative distribution"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="176">
<pre><code>Text(0.5, 1.0, 'Cumulative distribution')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="statistical-tests-to-determine-whether-the-distributions-are-equal" class="level2">
<h2 class="anchored" data-anchor-id="statistical-tests-to-determine-whether-the-distributions-are-equal">Statistical tests to determine whether the distributions are equal</h2>
</section>
<section id="mann-whitney-u-test" class="level2">
<h2 class="anchored" data-anchor-id="mann-whitney-u-test">Mann-Whitney U Test</h2>
<p>Null hypothesis: the two groups have the same distribution <br> Alternative hypothesis: one group has larger (or smaller) values than the other <br> Assumption: variances of two groups are equal <br></p>
<section id="test-to-determine-if-variances-are-equal" class="level3">
<h3 class="anchored" data-anchor-id="test-to-determine-if-variances-are-equal">Test to determine if variances are equal</h3>
<p>In order to properly use the Mann-Whitney U Test, we need to determine whether variances differ significantly. The most common test used for that is F-test, however F-test is very sensitive to normality of the data (which here most often won’t be the case, instead it’s usually a positively skewed distribution). Instead, I’ll use more robust variants of the test. There are two options: Bartlett’s and Levene’s test. Levene’s test is an alternative to Bartlett’s when there are significant deviations from normality. I’ll perform both tests and compare the results.</p>
<p>Null hypothesis: all input samples are from populations with equal variances</p>
<div class="cell" data-execution_count="177">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.05</span> <span class="co"># significance level</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="178">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> bartlett, levene</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Bartlett's test</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>stat, p_value <span class="op">=</span> bartlett(msgs_per_day_a1[<span class="st">'Message count'</span>], msgs_per_day_a2[<span class="st">'Message count'</span>])</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bartlett's Test: statistic=</span><span class="sc">{</span>stat<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">Conclusion: </span><span class="sc">{</span><span class="st">'Do not reject'</span> <span class="cf">if</span> p_value <span class="op">&gt;=</span> alpha <span class="cf">else</span> <span class="st">'Reject'</span><span class="sc">}</span><span class="ss"> null hypothesis under significance level of </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Levene's test</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>stat, p_value <span class="op">=</span> levene(msgs_per_day_a1[<span class="st">'Message count'</span>], msgs_per_day_a2[<span class="st">'Message count'</span>])</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Levene's Test: statistic=</span><span class="sc">{</span>stat<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">Conclusion: </span><span class="sc">{</span><span class="st">'Do not reject'</span> <span class="cf">if</span> p_value <span class="op">&gt;=</span> alpha <span class="cf">else</span> <span class="st">'Reject'</span><span class="sc">}</span><span class="ss"> null hypothesis under significance level of </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bartlett's Test: statistic=0.0712, p-value=0.7896
Conclusion: Do not reject null hypothesis under significance level of 0.05.
Levene's Test: statistic=1.1433, p-value=0.2850
Conclusion: Do not reject null hypothesis under significance level of 0.05.</code></pre>
</div>
</div>
<p>After performing the mentioned tests, I can now perform the Mann-Whitney U test to finally conclude whether or not the distributions are the same.</p>
<div class="cell" data-execution_count="179">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> mannwhitneyu</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>stat, p_value <span class="op">=</span> mannwhitneyu(msgs_per_day_a1[<span class="st">'Message count'</span>], msgs_per_day_a2[<span class="st">'Message count'</span>])</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mann-Whitney U Test: statistic=</span><span class="sc">{</span>stat<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">Conclusion: </span><span class="sc">{</span><span class="st">'Do not reject'</span> <span class="cf">if</span> p_value <span class="op">&gt;=</span> alpha <span class="cf">else</span> <span class="st">'Reject'</span><span class="sc">}</span><span class="ss"> null hypothesis under significance level of </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mann-Whitney U Test: statistic=1416884.5000, p-value=0.3386
Conclusion: Do not reject null hypothesis under significance level of 0.05.</code></pre>
</div>
</div>
</section>
</section>
<section id="distribution-of-messages-during-the-day" class="level2">
<h2 class="anchored" data-anchor-id="distribution-of-messages-during-the-day">Distribution of messages during the day</h2>
<p>The next plot will show overall distribution of messages during the day and answer the question at what time of the day is the most conversation happening.</p>
<div class="cell" data-execution_count="180">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>msgs_per_hour <span class="op">=</span> df.groupby(by<span class="op">=</span>[<span class="st">'Time'</span>], as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">'Content'</span>].count()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>msgs_per_hour[<span class="st">'Time'</span>] <span class="op">=</span> pd.to_datetime(msgs_per_hour[<span class="st">'Time'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> t: <span class="bu">str</span>(t))) <span class="co"># this is so dumb to do</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>msgs_per_hour <span class="op">=</span> msgs_per_hour.groupby(pd.Grouper(key<span class="op">=</span><span class="st">'Time'</span>, freq<span class="op">=</span><span class="st">'1H'</span>)).<span class="bu">sum</span>().reset_index()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>msgs_per_hour.rename(columns<span class="op">=</span>{<span class="st">'Content'</span>: <span class="st">'Message count'</span>, <span class="st">'Time'</span>: <span class="st">'Hour'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>missing_times <span class="op">=</span> pd.date_range(start<span class="op">=</span><span class="st">'00:00'</span>, end<span class="op">=</span><span class="st">'23:00'</span>, freq<span class="op">=</span><span class="st">'1H'</span>).difference(msgs_per_hour[<span class="st">'Hour'</span>]).values</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>msgs_per_hour <span class="op">=</span> pd.concat(</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    [msgs_per_hour, pd.DataFrame(data<span class="op">=</span>[[time, <span class="dv">0</span>] <span class="cf">for</span> time <span class="kw">in</span> missing_times], columns<span class="op">=</span>[<span class="st">'Hour'</span>, <span class="st">'Message count'</span>])],</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>msgs_per_hour[<span class="st">'Hour'</span>] <span class="op">=</span> msgs_per_hour[<span class="st">'Hour'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> t: t.hour)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">7</span>))</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.barplot(x<span class="op">=</span><span class="st">'Hour'</span>, y<span class="op">=</span><span class="st">'Message count'</span>, data<span class="op">=</span>msgs_per_hour)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Number of messages sent during each hour of the day"</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>total_msgs <span class="op">=</span> <span class="bu">sum</span>(msgs_per_hour[<span class="st">'Message count'</span>].to_numpy())</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> ax.patches</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(patches)):</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> patches[i].get_x() <span class="op">+</span> patches[i].get_width() <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> patches[i].get_height() <span class="op">+</span> <span class="fl">0.05</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="st">'</span><span class="sc">{:.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(msgs_per_hour[<span class="st">'Message count'</span>][i] <span class="op">/</span> total_msgs <span class="op">*</span> <span class="dv">100</span>), (x, y), ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="distribution-of-messages-during-the-week" class="level2">
<h2 class="anchored" data-anchor-id="distribution-of-messages-during-the-week">Distribution of messages during the week</h2>
<p>Similarly to the last visualization, I’ll show the distribution of messages depending on the day of the week using a pie chart.</p>
<div class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>msgs_per_weekday <span class="op">=</span> msgs_per_day.copy(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>msgs_per_weekday[<span class="st">'Day'</span>] <span class="op">=</span> pd.to_datetime(msgs_per_weekday[<span class="st">'Day'</span>])</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>msgs_per_weekday[<span class="st">'Day'</span>] <span class="op">=</span> msgs_per_weekday[<span class="st">'Day'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> t: t.weekday())</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>msgs_per_weekday <span class="op">=</span> msgs_per_weekday.groupby(by<span class="op">=</span>[<span class="st">'Day'</span>], as_index<span class="op">=</span><span class="va">False</span>).<span class="bu">sum</span>()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>msgs_per_weekday.rename(columns<span class="op">=</span>{<span class="st">'Day'</span>: <span class="st">'Day of the week'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>msgs_per_weekday[<span class="st">'Day of the week'</span>] <span class="op">=</span> msgs_per_weekday[<span class="st">'Day of the week'</span>].<span class="bu">map</span>(</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    {<span class="dv">0</span>: <span class="st">'Monday'</span>, <span class="dv">1</span>: <span class="st">'Tuesday'</span>, <span class="dv">2</span>: <span class="st">'Wednesday'</span>, <span class="dv">3</span>: <span class="st">'Thursday'</span>, <span class="dv">4</span>: <span class="st">'Friday'</span>, <span class="dv">5</span>: <span class="st">'Saturday'</span>, <span class="dv">6</span>: <span class="st">'Sunday'</span>})</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">7</span>))</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">'pastel'</span>)[<span class="dv">0</span>:<span class="dv">6</span>]</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>pie <span class="op">=</span> plt.pie(msgs_per_weekday[<span class="st">'Message count'</span>], labels<span class="op">=</span>msgs_per_weekday[<span class="st">'Day of the week'</span>], colors<span class="op">=</span>colors,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>              autopct<span class="op">=</span><span class="st">'</span><span class="sc">%.3f%%</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="discord-analyzer_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="statistical-test-to-determine-if-messages-per-weekday-have-uniform-distribution" class="level2">
<h2 class="anchored" data-anchor-id="statistical-test-to-determine-if-messages-per-weekday-have-uniform-distribution">Statistical test to determine if messages per weekday have uniform distribution</h2>
<section id="chi-squared-test" class="level3">
<h3 class="anchored" data-anchor-id="chi-squared-test">Chi-Squared Test</h3>
<p>Chi-Squared test is used to determine whether the observed frequencies match the expected frequencies. I can take the observed number of messages per weekday and compare them to expected number of messages per weekday were it distributed uniformly (meaning each day would have <code>total_messages / 7</code> messages).</p>
<p>Null hypothesis: observed frequencies do not differ significantly from expected frequencies <br> Alternative hypothesis: ! null hypothesis <br> Assumption: all observed and expected frequencies are at least 5 <br></p>
<div class="cell" data-execution_count="182">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> chisquare</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (msgs_per_weekday[<span class="st">'Message count'</span>] <span class="op">&gt;</span> <span class="dv">5</span>).<span class="bu">all</span>()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>stat, p_value <span class="op">=</span> chisquare(f_obs<span class="op">=</span>msgs_per_weekday[<span class="st">'Message count'</span>])</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Chi-Squared Test: statistic=</span><span class="sc">{</span>stat<span class="sc">:.4f}</span><span class="ss">, p-value=</span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ch">\n</span><span class="ss">Conclusion: </span><span class="sc">{</span><span class="st">'Do not reject'</span> <span class="cf">if</span> p_value <span class="op">&gt;=</span> alpha <span class="cf">else</span> <span class="st">'Reject'</span><span class="sc">}</span><span class="ss"> null hypothesis under significance level of </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Chi-Squared Test: statistic=519.6691, p-value=0.0000
Conclusion: Reject null hypothesis under significance level of 0.05.</code></pre>
</div>
</div>
</section>
</section>
<section id="the-initiator" class="level2">
<h2 class="anchored" data-anchor-id="the-initiator">The initiator</h2>
<p>The idea here is to determine who mostly starts a conversation in a day. For this purpose, I’ll define the initiator as the person who sends the first message in a day (past 5 AM) to figure out which person initiates the conversations more often.</p>
<div class="cell" data-execution_count="183">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>msg_initiator <span class="op">=</span> df[df[<span class="st">'Time'</span>] <span class="op">&gt;</span> pd.to_datetime(<span class="st">'05:00'</span>).time()] <span class="co"># assume normal sleep schedule</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>msg_initiator <span class="op">=</span> msg_initiator.groupby(by<span class="op">=</span>[<span class="st">'Date'</span>], as_index<span class="op">=</span><span class="va">False</span>).first()</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>msg_initiator[<span class="st">'Author'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="183">
<pre><code>A    1096
S     571
Name: Author, dtype: int64</code></pre>
</div>
</div>
<p>Seems like <code>A</code> is initiating a lot more conversations than <code>S</code>, whoever that may be.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>